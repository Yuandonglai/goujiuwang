"use strict";$(function(){window.localStorage.username?($("#dlzc").css("display","none"),$("#user").append("欢迎您"+localStorage.username).css({"font-size":"14px",color:"#d5182a","line-height":"30px"}),$("#user").css("display","block")):($("#dlzc").css("display","block"),$("#user").css("display","none")),$("#zhuxiao").on("click",function(){window.localStorage.clear(),alert("已退出登录"),window.location.reload()});ajax("post","../api/gouwuche.php","",function(t){var n=JSON.parse(t).map(function(t){return' <table class="cart_goods_area" id="tbcart" data-id = "'+t.id+'">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr class="go">\n\t\t\t\t\t\t\t\t<td class="cb_1">\n\t\t\t\t\t\t\t\t\t<input type="checkbox" id="che1">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="cb_2">\n\t\t\t\t\t\t\t\t\t<img src="'+t.img1+'" alt="">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="cb_3">\n\t\t\t\t\t\t\t\t\t<a style="color:#06c;margin-left: 4px;" href="javascript:;"> '+t.name+'</a>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="cb_4">\n\t\t\t\t\t\t\t\t\t<span>￥'+t.price+'</span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="cb_5">-</td>\n\t\t\t\t\t\t\t\t<td class="cb_6">\n\t\t\t\t\t\t\t\t\t<span class="cutnum fl">-</span>\n\t\t\t\t\t\t\t\t\t<input type="text" value="'+t.num+'" maxlength="4" class="nownum fl">\n\t\t\t\t\t\t\t\t\t<span class="addnum fl">+</span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="cb_7">\n\t\t\t\t\t\t\t\t\t<span id="sum" class="cs_sum">\n\t\t\t\t\t\t\t\t\t\t<b class="pr">¥'+t.xiaoji+'</b>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td class="cb_8">\n\t\t\t\t\t\t\t\t\t<span class="coll_opt"><a href="javascript:;">收藏&nbsp;&nbsp;</a></span>\n\t\t\t\t\t\t\t\t\t<span class="del_opt"><a class="del" href="javascript:;">删除</a></span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>'}).join("");getid("card_goods").innerHTML=n,function(){function c(t){var n=1*t.parent().find("input").val(),a=t.parent().prev().prev().children().text().slice(1),e=(n*a).toFixed(2);t.parent().next().children().children().html("￥"+e),o()}$("#card_goods").on("keyup",".nownum",function(){c($(this))}),$("#card_goods").on("click",".del_opt",function(){var t=confirm("您确定要删除吗？");if(t){var n=$(this).parent().parent().parent().parent().attr("data-id"),a="str=dele&id="+n;ajax("post","../api/updatecar.php",a,function(t){location.reload()}),$(this).parent().parent().remove()}o()}),$("#card_goods").on("click",".addnum",function(){var t=1*$(this).prev().val();100<=++t&&(t=100),$(this).prev().val(t),c($(this));var n=$(this).parent().parent().parent().parent().attr("data-id"),a=$(this).parent().next().children().children().html().slice(1),e="str=add&id="+n+"&num="+t+"&xiaoji="+a;ajax("post","../api/updatecar.php",e,function(t){console.log(t)})}),$("#card_goods").on("click",".cutnum",function(){var t=1*$(this).next().val();--t<=1&&(t=1);var n=$(this).parent().parent().parent().parent().attr("data-id"),a=$(this).parent().next().children().children().html().slice(1);console.log(a);var e="str=minus&id="+n+"&num="+t+"&xiaoji="+a;ajax("post","../api/updatecar.php",e,function(t){console.log(t)}),$(this).next().val(t),c($(this))}),$(".dele_box input").on("click",function(){$(".dele_box input").prop("checked")?$(".cb_1 input").prop("checked",!0):$(".cb_1 input").prop("checked",!1),o()}),$(".cb_1 input").on("click",function(){var t=$(".cb_1 input:checked").size();t==$(".cb_1 input").size()?$(".dele_box input").prop("checked",!0):$(".dele_box input").prop("checked",!1),o()});var e=[];function o(){e=[],$(".cb_1 input").each(function(t,n){$(".cb_1 input").eq(t).prop("checked")&&e.push(t)});var n=0,a=0;e.forEach(function(t){n+=1*$(".nownum").eq(t).val(),a+=1*$(".pr").eq(t).text().slice(1)}),$(".gw").html(n),$("#playmoney").html("￥"+a)}$(".de_a").on("click",function(){var t=confirm("您确定要删除多个商品吗？");if(t){ajax("post","../api/updatecar.php","str=deldeall",function(t){location.reload()});for(var n=e.length-1;0<=n;n--)$(".go").eq(e[n]).remove()}e=[],o()}),$(".de_clear").on("click",function(){var t=confirm("你确定要清除购物车吗？");if(t){ajax("post","../api/updatecar.php","str=deldeall",function(t){});for(var n=e.length;0<=n;n--)$(".go").remove()}e=[],o()})}()}),document.getElementsByClassName("close")[0].onclick=function(){window.localStorage.username?alert("结算成功"):(alert("请登录"),window.location.href="denglu.html")};var t=document.getElementsByClassName("againshop")[0];console.log(t),t.onclick=function(){window.location.href="liebiao.html"}});